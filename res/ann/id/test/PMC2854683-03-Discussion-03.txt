Microarray validation and analysis 
Although our microarray studies were extensive (28 arrays for 4 conditions), we ran qPCR to validate the microarray findings, focusing on virulence genes that are biomarkers of the bacterial switch to a hypervirulent phenotype. These include SpeA, SpeB, Sda1, M protein, and SIC [data published in 14]. Comparing the microarray data in this study with previously published work provides further validation of these results. For example, the in vitro microarray results are consistent with our previous proteomic studies of the WT and AP secreted bacterial proteomes [12] as well as with other recently published studies of the in vitro transcriptome of closely related strains [13], [26], [27]. Importantly, we did not base our analysis on single measurements of gene expression, nor did we focus on individual genes; rather, we used gene expression data from biological replicates to rule out biological variability (especially between bacteria recovered from different mice) and to look for changes in gene clusters, operons, and pathways. In doing so, we were able to assess trends across experiments rather than absolute numerical values that could vary due to technical rather than biological factors. We believe that this approach provided more confidence in the final assessment of which genes/pathways were expressed similarly or differentially in both WT and AP bacteria in vitro and in vivo. It also allowed us to dissect changes related to niche adaptation from those reflecting the selection of the fittest members of the bacterial community when faced with different environments and conditions. The use of multiple microarray analysis strategies and the integration of their results strengthened this study since each strategy has advantages and disadvantages. For example, coexpression clustering-one of the earliest developed microarray analysis tools [62], [63]-provides an overall view of expression patterns of different genes, and greatly helps dissect and demonstrate the effect of each condition on the overall transcriptome. However, coexpression analysis alone can miss some biologically relevant genes that could fail the statistical tests for non-biological reasons (e.g., poorly hybridizing probes, low signal-to-noise ratio, or high variance) and may instead include some irrelevant genes in isolation of their biological networks [41]. In bacteria, biochemical pathways, virulence systems, and multimeric proteins are often encoded next to each other by chromosomally contiguous or clustered genes [64], [65]. Analyzing coexpressed genes in the context of chromosomal clusters is thus most informative. Indeed, neighbor clustering [41] has allowed the enrichment for contiguous gene sets and the prediction of more context-related expression patterns. Genes in neighbor clusters could have been otherwise overlooked either because they were misannotated but their co-occurrence in known clusters revealed their importance, or because they did not pass the statistical tests but, since many bacterial transcripts are polycistronic, the expression of two or more members of a polycistron strongly suggests that the whole operon is expressed. Besides these two clustering methods, expression ratios provided pairwise comparison, thereby allowing the quantification of the impact of each individual change of condition on overall gene expression (Table 2) as well as on specific genes of interest (Table 3). However, the use of ratios alone may be misleading, especially when they are calculated between two transcripts with low expression levels, resulting in spurious ratios of low biological significance. Similarly, the common use of statistical constraints with ratio calculation (e.g., two-fold ratios and P values <0.05) filters out many biologically relevant genes that are true positives. Finally, the use of operons, subsystems, and pathways to describe the array results avoids inappropriately building conclusions on the transcriptional changes of individual genes and thus better reflects biologically relevant perturbations in specific pathways.
